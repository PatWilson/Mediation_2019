---
title: "Mediation"
author: "Patrick Wilson MPH"
date: "08/16/2018"
output:
  xaringan::moon_reader:
    seal: false
---
class: inverse, center, middle
background-image: url(lance-grandahl-1058975-unsplash.jpg)
background-size: cover

<img src="mediation.png"/>

.large[Patrick Wilson | Causal Inference Forum | May 17, 2019]


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE)

library(arsenal)
library(tidyverse)
library(broom)
library(knitr)
library(kableExtra)
```


---
name: greens-cover
class: center, middle, inverse
background-image: url(lance-grandahl-1058975-unsplash.jpg)
background-size: cover


# What We Hope to Go Over


---
# Objectives

--
- Background 

--

- Causal Estimands and DAGS

--

- Mediation Assessment and Heuristics


--

- Example of Mediation Analyses

--

- Resources

---
class: inverse, middle, center
background-image: url(lance-grandahl-1058975-unsplash.jpg)
background-size: cover

# What is Mediation Analyses?


---
## Overview 
--

- Mediation seeks to describe the mechanism by which a cause affects an outcome

--

- In this model an intervention is theorized to affect an outcome through another variable known as a mediator

--

- One can then decompose intervention effects into through changing the mediator which changes the outcome (indirect effect) and through some other mechinanism or set of mechanisms (direct effect)

--

- Formalized in Baron & Kenny with linear regression (1986) 



---
## What does Causal inference add?

--

- Mediation is inherently a causal question, and additional assumptions are needed
Baron and Kenny approach limitations with respect to interactions and nonlinearitiies

--

- Given this notion it is makes sense to try to measure mediation through a potential outcome or counterfactual framework

--

- Greenland, Robins, and Pearl formulated Causal mediation analyses and developed the causal notion of direct effect and indirect effect.


---
##Benefits Include....

--

- Principled approach that states assumptions clearly

--

- PO framework is generalized so models can be easily extended to handle nonlinearities and interactions


---
class: inverse, middle, center
background-image: url(lance-grandahl-1058975-unsplash.jpg)
background-size: cover

# What kind of questions can you ask?

---
## Pain Example

---
## Depression

> A randomized cognitive behavioral therapy (CBT) intervention estimated an effect on depression symptoms after 3 months of follow up. However, it was noted that the intervention also had an effect on adherance to their antidepressants regimen. Did the beneficial effect of CBT on depressive symptoms because it led to  antidepressant adherance or did CBT affect depressive symptoms through other pathways?

---
## Clinical Biomarker

> For example, if one wishes to evaluate an intervention on smoking in the prevention of cardiovascular disease. A possible mechanism is that smoking impacts changes in lipid levels causing hyperlipidemia. One might ask what fraction of smoking's effect could be eliminated by eliminating hyperlipdemia through diet and or medication.  

---
## Reproductive Epidemiology

> A recent analysis focused on the mediating effects relating placental abruption (exposure) and perinatal mortality (outcome) through the role of preterm delivery (mediator). The investigators sought to address 2 important issues: 1) Is the increased risk of mortality in relation to abruption entirely dependent (i.e., mediated) on preterm delivery? and 2) If not, what proportion of the increased mortality risk is directly the consequence of abruption through pathways other than preterm delivery?

---
## Social Epidemiology Example

---
## Genetic Epidemiology 

> Research has found associations between genetic variants on chromosome 15q25.1 and lung cancer. These variants were also known to be associated with smoking. Not only was there a hypothesis of mediation but also that the variant may increase indivduals'vulnerability to the harmful effect of smoking (gene-environment interaction). 

---
class: inverse, middle, center
background-image: url(lance-grandahl-1058975-unsplash.jpg)
background-size: cover


---
# Causal Estimands and DAGS 


## The DAG
```{r, out.width = "95%"}
knitr::include_graphics("uninformative_table.png")
```




---
## Estimands 

-The Baron/Kenny model is actually two regression models 


$$E(M|a,c) = \beta_0 + \beta_1a + \beta_2c$$


$$E(Y|m,a,c) = \theta_0 + \theta_1a + \theta_2m + \theta_4c$$

Where $\theta_1$ is the "direct" effect and $\beta_1\theta_2$ is the "indirect" effect


---
##Interpretation and Derivative Measures

The three primary estimands of interest are the controlled direct effect (CDE), natural direct effect (NDE), and natural indirect effect (NIE). Using the extended regression model:

$$E(Y|m,a,c) = \theta_0 + \theta_1a + \theta_2m + \theta_3am + \theta_4c$$
---
##Controlled Direct Effect 

$$CDE(m) = \theta_1 +\theta_3m(a-a^*)$$

How much the outcome would change on average if the mediator were fixed at level m uniformly in the population but the treatment were changed from level $a^*=0$ to $a=1$ 

$$Y_{a=1,m=m} - Y_{a=0,m=m}$$

In layman's terms:

If we intervened to set the mediator to a certain level what is the effect of intervention?

---
##Natural Direct Effect

$$NDE = (\theta_1 +\theta_3\beta_0 + \theta_3\beta_1a^* + \theta_3\beta_2c)(a-a^*)$$
How much the outcome would change if the exposure were set at level $a=1$ vs. $a^*=0$  but for each individual the mediator were kept at the level it would have taken, for that individual in the absence of the exposure.

$$Y_{a=1,~m=M_0} - Y_{a=0,~m=M_0}$$

In layman's terms: If we intervened to block the effect of a mediator what is the effect of intervention?

---
## Natural Indirect Effect

$$NIE = (\theta_2\beta_1 + \theta_3\beta_1a)(a-a^*)$$
How much the outcome would change on average if the exposure were fixed at level a=1 but the mediator were changed from the level it would take if a=0 to the level it would take if a=0


$$Y_{a=1,~m=M_1} - Y_{a=1,~m=M_0}$$

In layman's terms: What is the effect of the intervention by changing the mediator?


---
## Dervivates

-- 
Total effect
$$ TE = NDE + NIE   $$
--
Proportion Mediated
$$PM = \frac{NIE}{TE} $$

--
Proportion Eliminated
$$PE(m) = \frac{TE - CDE(m)}{TE} $$


---
name: Assumptions
class: center, middle, inverse
background-image: url(http://bit.ly/arm-greens)
background-size: cover


---
##Handle Nonlinear Models 

```{r}
models <- data.frame( Model = c("Continuous", 
                                       "Binary", 
                                       "Count",
                                       "AFT", 
                                       "PH",
                                       "Additive Hazard"), 
                                  
                              Mediator = c("Y", 
                                       "Y", 
                                       "N",
                                       "N", 
                                       "N",
                                       "N"), 
                              outcome = c("Y", 
                                       "Y", 
                                       "Y",
                                       "Y", 
                                       "Y",
                                       "Y"))

kable(models, "html", escape = F) %>% 
  kable_styling("striped", full_width = F, font_size = 20) 
```


---
##Integrate Interaction

Example of interaction, principle reason for using counterfactual 


---
name: Assumptions
class: center, middle, inverse
background-image: url(http://bit.ly/arm-greens)
background-size: cover


## No Treatment-Outcome Confounding

```{r, out.width = "95%"}
knitr::include_graphics("uninformative_table.png")
```

 
## No Mediator-Outcome Confounding
 
```{r, out.width = "95%"}
knitr::include_graphics("uninformative_table.png")
```
 

## No Treatment-Mediator Confounding

```{r, out.width = "95%"}
knitr::include_graphics("uninformative_table.png")
```


## No Mediator-Outcome Confounding That is an Effect of Treatment
 
```{r, out.width = "95%"}
knitr::include_graphics("uninformative_table.png")
```


---
class: inverse, middle, center
background-size: contain

# Mediation Assessment and Heuristics

---
## A Tale of Two DAGS 

.pull-left[

```{r, out.width = "95%"}
knitr::include_graphics("uninformative_table.png")
```


]
.pull-right[

```{r, out.width = "95%"}
knitr::include_graphics("uninformative_table.png")
```


]

---
## Assessing Mediation

--
Should you adjust for Z? 

--
*Obviously* you wouldn't adjust if it is a mediator but you would adjust of a confounder 

--
How do you tell? 

--
Even if you or your investigator is not interested in Mediation *per se* you could be adjusting for a variable that is on the pathway and therefore creating a biased estimate of your effect



---
## Some good rules of thumb

--
Study design and the paramount importance of time


--
Measuring distinct constructs


--
Causal discovery? And the fishing problem


---
## Data example 



```{r}
#put awesome data here 
```



---
##Software

Mediation macro TW LW
Proc casualmed 
mediation in R




---
##References

